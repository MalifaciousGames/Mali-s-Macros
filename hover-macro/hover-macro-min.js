/* Mali's <<hover>> macro */
(()=>{let p=0,u=!1;const h=$("<div>").attr({id:"macro-hover-tip","aria-live":"polite"}),n=()=>{u=!1,h.attr({"aria-hidden":!0}).removeClass().empty()};$(document).on("scroll",t=>{var e,a,i;u&&(a=(e=$(document).scrollTop())-p,i=Number(h.css("top").slice(0,-2)),h.css({top:i-a}),p=e)}).on(":passageinit",n),Macro.add("hover",{tags:["swap","tip"],handler(){const t=this.args.find(t=>"object"==typeof t)??{},a={},i=$("<span>"),e=this.payload[0].contents,s={in:[],out:[]};let o=!1;if(t.tabindex=0,i.attr(t),this.payload.slice(1).forEach((t,e)=>{a[t.name]=t,i.addClass(t.name)}),a.swap&&(s.in.push(t=>{i.empty().wiki(a.swap.contents)}),s.out.push(t=>{i.empty().wiki(e)})),a.tip){let t=[];a.tip.args.length&&(t=a.tip.args.map(t=>t.split(" ")).flat()),i.attr("role","tooltip"),s.in.push(((t,e,a)=>{u=!0,p=$(document).scrollTop(),e.append(h),h.removeClass().wiki(t);var{height:i,width:s}=h[0].getBoundingClientRect(),t=e[0].getBoundingClientRect();t.center={y:t.top+t.height/2,x:t.left+t.width/2};const o={up:{at:[t.center.x,t.top],stickout:{main:-(i+4),sec:s/2}},down:{at:[t.center.x,t.bottom],stickout:{main:i+4,sec:s/2}},left:{at:[t.left,t.center.y],stickout:{main:-(s+4),sec:i/2}},right:{at:[t.right,t.center.y],stickout:{main:s+4,sec:i/2}},over:{at:[t.center.x,t.center.y],stickout:{main:0,sec:0}}},n=t=>{var e=o[t],a=[];switch(t){case"up":case"down":var i=e.at[1]+e.stickout.main;a.push(0<i&&i<window.innerHeight,0<e.at[0]-e.stickout.sec,e.at[0]+e.stickout.sec<window.innerWidth);break;case"left":case"right":i=e.at[0]+e.stickout.main;a.push(0<i&&i<window.innerWidth,0<e.at[1]-e.stickout.sec,e.at[1]+e.stickout.sec<window.innerHeight);break;default:a.push(!0)}return a.every(t=>t)};a=(a=a.find(t=>n(t)))||["up","right","down","left","over"].find(t=>n(t));let[c,r]=o[a].at,{main:l,sec:d}=o[a].stickout;switch(a){case"up":r+=l,c-=d;break;case"down":r+=4,c-=d;break;case"left":r-=d,c+=l;break;case"right":r-=d,c+=4;break;default:c-=s/2,r-=i/2}h.attr({"aria-hidden":!1}).css({top:r,left:c}).addClass("visible "+a)}).bind(null,a.tip.contents,i,t)),s.out.push(n)}i.on("mouseenter focus",this.shadowHandler(t=>{o||(o=!0,s.in.forEach(t=>t.call()))})).on("mouseleave focusout",t=>{o=!1,s.out.forEach(t=>t.call())}).wiki(e).addClass("macro-"+this.name).appendTo($(this.output))}})})();
